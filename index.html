<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QuizMaster - Interactive Quiz App</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800&display=swap');
        
        * {
            font-family: 'Poppins', sans-serif;
            box-sizing: border-box; /* Crucial for consistent box model */
        }
        
        body {
            background-color: #282C34; /* Base dark charcoal */
            overflow-x: hidden; /* Prevent horizontal scrollbar from animated background */
            min-height: 100vh; /* Ensure body takes full viewport height */
            display: flex;
            flex-direction: column;
            justify-content: center; /* Center content vertically */
            align-items: center; /* Center content horizontally */
        }

        /* Unique Nebula Background */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: 
                radial-gradient(circle at 15% 50%, rgba(97, 175, 239, 0.08) 0%, transparent 40%), /* Light Blue - Reduced opacity */
                radial-gradient(circle at 85% 30%, rgba(224, 108, 117, 0.08) 0%, transparent 40%), /* Red - Reduced opacity */
                radial-gradient(circle at 40% 80%, rgba(152, 195, 121, 0.08) 0%, transparent 40%), /* Green - Reduced opacity */
                radial-gradient(circle at 60% 10%, rgba(171, 178, 191, 0.08) 0%, transparent 40%), /* Light Gray - Reduced opacity */
                radial-gradient(circle at 5% 90%, rgba(255, 215, 0, 0.06) 0%, transparent 40%); /* Gold - Reduced opacity */
            background-size: 150% 150%;
            animation: nebulaFlow 25s ease-in-out infinite alternate; /* Slower animation */
            z-index: 0; /* Ensure it stays behind content */
            pointer-events: none; /* Make sure it doesn't block clicks */
        }

        @keyframes nebulaFlow {
            0% { background-position: 0% 0%; }
            100% { background-position: 100% 100%; }
        }
        /* End Unique Nebula Background */

        .glass {
            backdrop-filter: blur(16px);
            -webkit-backdrop-filter: blur(16px);
            background-color: rgba(255, 255, 255, 0.08); /* Slightly more opaque white */
            box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.37);
            border: 1px solid rgba(255, 255, 255, 0.18); /* Subtle border for glass effect */
        }
        
        .flip-card {
            perspective: 1000px;
            height: auto; /* Allow card height to adjust to content */
            min-height: 350px; /* Minimum height for visual consistency */
        }
        
        .flip-card-inner {
            position: relative;
            width: 100%;
            height: 100%;
            text-align: center;
            transition: transform 0.6s;
            transform-style: preserve-3d;
        }
        
        .flip-card.flipped .flip-card-inner {
            transform: rotateY(180deg);
        }
        
        .flip-card-front, .flip-card-back {
            position: absolute;
            width: 100%;
            height: 100%;
            -webkit-backface-visibility: hidden;
            backface-visibility: hidden;
            border-radius: 1.5rem;
            display: flex; 
            flex-direction: column;
            justify-content: space-between; /* Distribute space between icon/question and options */
            align-items: center;
            padding: 2rem; /* Consistent padding inside the card */
        }
        
        .flip-card-back {
            transform: rotateY(180deg);
        }
        
        .progress-bar {
            transition: width 0.5s ease-in-out;
        }
        
        .bounce-in {
            animation: bounceIn 0.6s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }
        
        .fade-in {
            animation: fadeIn 0.5s ease-in-out;
        }
        
        .slide-up {
            animation: slideUp 0.4s ease-out;
        }
        
        .pulse-correct {
            animation: pulseCorrect 0.6s ease-in-out forwards; /* Keep final state */
        }
        
        .pulse-incorrect {
            animation: pulseIncorrect 0.6s ease-in-out forwards; /* Keep final state */
        }
        
        @keyframes bounceIn {
            0% {
                opacity: 0;
                transform: scale(0.3);
            }
            50% {
                opacity: 1;
                transform: scale(1.05);
            }
            70% {
                transform: scale(0.9);
            }
            100% {
                opacity: 1;
                transform: scale(1);
            }
        }
        
        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        @keyframes pulseCorrect {
            0%, 100% {
                transform: scale(1);
            }
            50% {
                transform: scale(1.02);
                box-shadow: 0 0 25px rgba(152, 195, 121, 0.9); /* Green glow */
            }
        }
        
        @keyframes pulseIncorrect {
            0%, 100% {
                transform: scale(1);
            }
            50% {
                transform: scale(1.02);
                box-shadow: 0 0 25px rgba(224, 108, 117, 0.9); /* Red glow */
            }
        }
        
        .timer-pulse {
            animation: timerPulse 1s ease-in-out infinite;
        }
        
        @keyframes timerPulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }
        
        /* Mobile optimizations */
        @media (max-width: 640px) {
            .question-text {
                font-size: 1.125rem;
                line-height: 1.6;
            }
            
            .answer-option {
                padding: 1rem;
                font-size: 0.875rem;
            }
            
            .mobile-stack {
                flex-direction: column;
                gap: 0.75rem;
            }
            .question-info-bar { /* Adjusted for mobile */
                flex-direction: column;
                gap: 0.5rem;
                padding: 0.5rem;
            }
        }

        /* Loading Spinner for LLM call */
        .loader {
            border: 4px solid #f3f3f3; /* Light grey */
            border-top: 4px solid #61AFEF; /* Blue */
            border-radius: 50%;
            width: 24px;
            height: 24px;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="relative">
    <!-- Main content container -->
    <div class="relative z-10 container mx-auto px-4 py-8 max-w-4xl flex-grow">
        <!-- Header -->
        <div class="text-center mb-8 fade-in">
            <div class="flex items-center justify-center gap-4 mb-6">
                <div class="p-4 bg-gradient-to-r from-blue-500 to-cyan-500 rounded-2xl shadow-lg bounce-in">
                    <i class="fas fa-brain text-white text-3xl"></i>
                </div>
                <h1 class="text-4xl md:text-5xl font-bold bg-gradient-to-r from-blue-400 to-cyan-400 bg-clip-text text-transparent">
                    QuizMaster
                </h1>
            </div>
            <p class="text-gray-300 text-lg mb-6">Test your knowledge across unique topics!</p>
        </div>

        <!-- Topic Selection Screen -->
        <div id="topicSelection" class="fade-in">
            <h2 class="text-2xl md:text-3xl font-bold text-white text-center mb-8">Choose Your Challenge</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                <!-- Space Exploration -->
                <div class="topic-card p-6 glass rounded-2xl hover:border-blue-400/50 transition-all cursor-pointer group" data-topic="space">
                    <div class="text-center">
                        <div class="w-16 h-16 mx-auto mb-4 bg-gradient-to-r from-purple-500 to-indigo-500 rounded-2xl flex items-center justify-center group-hover:scale-110 transition-transform">
                            <i class="fas fa-rocket text-white text-2xl"></i>
                        </div>
                        <h3 class="text-xl font-bold text-gray-100 mb-2">Space Exploration</h3>
                        <p class="text-gray-300 text-sm">Journey through the cosmos</p>
                        <div class="mt-4 text-blue-400 text-sm">10 Questions</div>
                    </div>
                </div>

                <!-- Mythical Creatures -->
                <div class="topic-card p-6 glass rounded-2xl hover:border-green-400/50 transition-all cursor-pointer group" data-topic="mythology">
                    <div class="text-center">
                        <div class="w-16 h-16 mx-auto mb-4 bg-gradient-to-r from-green-500 to-emerald-500 rounded-2xl flex items-center justify-center group-hover:scale-110 transition-transform">
                            <i class="fas fa-dragon text-white text-2xl"></i>
                        </div>
                        <h3 class="text-xl font-bold text-gray-100 mb-2">Mythical Creatures</h3>
                        <p class="text-gray-300 text-sm">Legends and folklore</p>
                        <div class="mt-4 text-green-400 text-sm">10 Questions</div>
                    </div>
                </div>

                <!-- Future Technology -->
                <div class="topic-card p-6 glass rounded-2xl hover:border-yellow-400/50 transition-all cursor-pointer group" data-topic="future">
                    <div class="text-center">
                        <div class="w-16 h-16 mx-auto mb-4 bg-gradient-to-r from-yellow-500 to-orange-500 rounded-2xl flex items-center justify-center group-hover:scale-110 transition-transform">
                            <i class="fas fa-robot text-white text-2xl"></i>
                        </div>
                        <h3 class="text-xl font-bold text-gray-100 mb-2">Future Tech</h3>
                        <p class="text-gray-300 text-sm">Tomorrow's innovations</p>
                        <div class="mt-4 text-yellow-400 text-sm">10 Questions</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Quiz Interface -->
        <div id="quizInterface" class="hidden">
            <!-- Progress Bar -->
            <div class="mb-6">
                <div class="flex justify-between items-center mb-2">
                    <span class="text-white font-medium">Progress</span>
                    <span class="text-white font-medium" id="progressText">1 / 10</span>
                </div>
                <div class="w-full bg-gray-700 rounded-full h-3 overflow-hidden">
                    <div id="progressBar" class="progress-bar h-full bg-gradient-to-r from-blue-500 to-cyan-500 rounded-full" style="width: 10%"></div>
                </div>
            </div>

            <!-- Question Info Bar (Timer, Icon, Question Number) -->
            <div class="glass rounded-2xl p-4 mb-8 flex justify-between items-center question-info-bar">
                <!-- Timer -->
                <div id="timer" class="inline-flex items-center gap-2 px-4 py-2 bg-gradient-to-r from-red-500 to-pink-500 rounded-full text-white font-bold shadow-md">
                    <i class="fas fa-clock"></i>
                    <span id="timeLeft">30</span>s
                </div>

                <!-- Question Icon and Number -->
                <div class="flex items-center gap-3">
                    <div id="questionIcon" class="w-12 h-12 bg-gradient-to-r from-purple-500 to-pink-500 rounded-full flex items-center justify-center shadow-md">
                        <i class="fas fa-question text-white text-xl"></i>
                    </div>
                    <div class="text-white font-medium text-lg" id="questionCounter">
                        Question 1 of 10
                    </div>
                </div>
                <!-- Placeholder for balance on desktop, hidden on mobile -->
                <div class="w-24 h-1 hidden sm:block"></div> 
            </div>

            <!-- Question Card -->
            <div class="flip-card mb-8" id="questionCard">
                <div class="flip-card-inner">
                    <div class="flip-card-front glass rounded-2xl">
                        <!-- Content of the front face -->
                        <div class="flex-grow flex flex-col justify-center items-center text-center">
                            <h2 class="question-text text-xl md:text-2xl font-bold text-white mb-6" id="questionText">
                                Loading question...
                            </h2>
                        </div>
                        
                        <div class="w-full space-y-4" id="answerOptions">
                            <!-- Answer options will be inserted here -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- Navigation -->
            <div class="flex justify-between items-center mobile-stack mt-8" id="navigation">
                <button id="prevBtn" class="px-6 py-3 bg-gray-600 hover:bg-gray-500 text-white rounded-xl transition-all disabled:opacity-50 disabled:cursor-not-allowed shadow-md">
                    <i class="fas fa-chevron-left mr-2"></i>Previous
                </button>
                
                <button id="nextBtn" class="px-6 py-3 bg-gradient-to-r from-blue-500 to-cyan-500 hover:shadow-xl text-white rounded-xl transition-all disabled:opacity-50 disabled:cursor-not-allowed shadow-md">
                    Next<i class="fas fa-chevron-right ml-2"></i>
                </button>
            </div>
        </div>

        <!-- Results Screen -->
        <div id="resultsScreen" class="hidden text-center">
            <div class="bounce-in">
                <div class="w-24 h-24 mx-auto mb-6 bg-gradient-to-r from-green-500 to-emerald-500 rounded-full flex items-center justify-center shadow-lg">
                    <i class="fas fa-trophy text-white text-4xl"></i>
                </div>
                
                <h2 class="text-3xl md:text-4xl font-bold text-white mb-4">Quiz Complete!</h2>
                
                <div class="glass rounded-2xl p-8 mb-8">
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6 text-center">
                        <div>
                            <div class="text-3xl font-bold text-blue-400" id="finalScore">0</div>
                            <div class="text-gray-300">Score</div>
                        </div>
                        <div>
                            <div class="text-3xl font-bold text-green-400" id="finalPercentage">0%</div>
                            <div class="text-gray-300">Accuracy</div>
                        </div>
                        <div>
                            <div class="text-3xl font-bold text-purple-400" id="finalTime">0s</div>
                            <div class="text-gray-300">Time</div>
                        </div>
                    </div>
                </div>
                
                <div class="flex flex-col sm:flex-row gap-4 justify-center">
                    <button id="reviewBtn" class="px-8 py-3 bg-gradient-to-r from-purple-500 to-pink-500 hover:shadow-xl text-white rounded-xl transition-all shadow-md">
                        <i class="fas fa-eye mr-2"></i>Review Answers
                    </button>
                    <button id="restartBtn" class="px-8 py-3 bg-gradient-to-r from-green-500 to-emerald-500 hover:shadow-xl text-white rounded-xl transition-all shadow-md">
                        <i class="fas fa-redo mr-2"></i>Try Again
                    </button>
                    <button id="newTopicBtn" class="px-8 py-3 bg-gradient-to-r from-blue-500 to-cyan-500 hover:shadow-xl text-white rounded-xl transition-all shadow-md">
                        <i class="fas fa-home mr-2"></i>New Topic
                    </button>
                </div>
            </div>
        </div>

        <!-- Review Screen -->
        <div id="reviewScreen" class="hidden">
            <div class="flex justify-between items-center mb-8 mobile-stack">
                <h2 class="text-2xl md:text-3xl font-bold text-white">Answer Review</h2>
                <button id="backToResultsBtn" class="px-4 py-2 bg-gray-600 hover:bg-gray-500 text-white rounded-xl transition-all shadow-md">
                    <i class="fas fa-arrow-left mr-2"></i>Back
                </button>
            </div>
            <div id="reviewContent" class="space-y-6">
                <!-- Review content will be populated here -->
            </div>
        </div>
    </div>

    <script>
        class QuizApp {
            constructor() {
                this.currentTopic = null;
                this.currentQuestionIndex = 0;
                this.userAnswers = []; // Stores the index of the user's chosen option
                this.score = 0;
                this.timer = null;
                this.timeLeft = 30; // Time per question
                this.totalTime = 0; // Total time taken for the quiz
                this.startTime = null; // Timestamp when quiz started

                // Hardcoded quiz data for different topics
                this.quizData = {
                    space: {
                        title: "Space Exploration",
                        icon: "fas fa-rocket",
                        questions: [
                            {
                                question: "What is the largest planet in our solar system?",
                                options: ["Earth", "Jupiter", "Saturn", "Neptune"],
                                correct: 1,
                                explanation: "Jupiter is the largest planet, with a mass greater than all other planets combined."
                            },
                            {
                                question: "Which space agency successfully landed the first humans on the Moon?",
                                options: ["ESA", "Roscosmos", "NASA", "CNSA"],
                                correct: 2,
                                explanation: "NASA's Apollo 11 mission successfully landed Neil Armstrong and Buzz Aldrin on the Moon in 1969."
                            },
                            {
                                question: "What is the closest star to Earth (besides the Sun)?",
                                options: ["Alpha Centauri", "Sirius", "Proxima Centauri", "Betelgeuse"],
                                correct: 2,
                                explanation: "Proxima Centauri is the closest star to Earth at about 4.24 light-years away."
                            },
                            {
                                question: "How long does it take for light from the Sun to reach Earth?",
                                options: ["8 minutes", "1 hour", "1 day", "1 second"],
                                correct: 0,
                                explanation: "Light from the Sun takes approximately 8 minutes and 20 seconds to reach Earth."
                            },
                            {
                                question: "Which planet is known for having the most prominent ring system?",
                                options: ["Jupiter", "Uranus", "Saturn", "Neptune"],
                                correct: 2,
                                explanation: "Saturn has the most visible and extensive ring system in our solar system."
                            },
                            {
                                question: "What is the name of the galaxy that contains our solar system?",
                                options: ["Andromeda", "Milky Way", "Whirlpool", "Triangulum"],
                                correct: 1,
                                explanation: "Our solar system is located in the Milky Way galaxy."
                            },
                            {
                                question: "Which planet has the strongest gravitational pull?",
                                options: ["Earth", "Jupiter", "Saturn", "Mars"],
                                correct: 1,
                                explanation: "Jupiter has the strongest gravitational pull due to its massive size and density."
                            },
                            {
                                question: "What is the temperature of absolute zero in space?",
                                options: ["-273°C", "-100°C", "-200°C", "-300°C"],
                                correct: 0,
                                explanation: "Absolute zero is -273.15°Celsius or 0 Kelvin, the coldest possible temperature."
                            },
                            {
                                question: "Which mission was the first to successfully land a rover on Mars?",
                                options: ["Viking 1", "Pathfinder", "Spirit", "Curiosity"],
                                correct: 1,
                                explanation: "The Mars Pathfinder mission in 1997 was the first to successfully deploy a rover (Sojourner) on Mars."
                            },
                            {
                                question: "What phenomenon causes the Northern and Southern Lights?",
                                options: ["Solar wind", "Meteor showers", "Moon phases", "Planetary alignment"],
                                correct: 0,
                                explanation: "Solar wind particles interacting with Earth's magnetic field create the aurora borealis and aurora australis."
                            }
                        ]
                    },
                    mythology: {
                        title: "Mythical Creatures",
                        icon: "fas fa-dragon",
                        questions: [
                            {
                                question: "In Greek mythology, what creature has the body of a lion and the head of a human?",
                                options: ["Griffin", "Sphinx", "Chimera", "Manticore"],
                                correct: 1,
                                explanation: "The Sphinx is known for its lion's body, human head, and often eagle's wings."
                            },
                            {
                                question: "Which Norse mythological creature is an eight-legged horse?",
                                options: ["Fenrir", "Sleipnir", "Jörmungandr", "Huginn"],
                                correct: 1,
                                explanation: "Sleipnir is Odin's eight-legged horse, capable of traveling between worlds."
                            },
                            {
                                question: "What is a phoenix known for doing?",
                                options: ["Breathing ice", "Rising from ashes", "Turning to stone", "Flying backwards"],
                                correct: 1,
                                explanation: "The phoenix is a mythical bird that cyclically burns itself and rises from its own ashes."
                            },
                            {
                                question: "In Japanese folklore, what is a Kitsune?",
                                options: ["Dragon", "Fox spirit", "Sea serpent", "Mountain giant"],
                                correct: 1,
                                explanation: "Kitsune are intelligent fox spirits in Japanese folklore, often possessing magical abilities."
                            },
                            {
                                question: "Which creature from Celtic mythology shapeshifts from seal to human?",
                                options: ["Banshee", "Selkie", "Leprechaun", "Dullahan"],
                                correct: 1,
                                explanation: "Selkies are mythological beings capable of shapeshifting from seal to human form."
                            },
                            {
                                question: "What does the Minotaur have the head of?",
                                options: ["Lion", "Eagle", "Bull", "Wolf"],
                                correct: 2,
                                explanation: "The Minotaur from Greek mythology has the head of a bull and the body of a man."
                            },
                            {
                                question: "Which creature is said to turn people to stone with its gaze?",
                                options: ["Medusa", "Harpy", "Siren", "Cyclops"],
                                correct: 0,
                                explanation: "Medusa, one of the three Gorgon sisters, could turn anyone who looked at her to stone."
                            },
                            {
                                question: "In Chinese mythology, what do dragons typically symbolize?",
                                options: ["Evil and destruction", "Good fortune and power", "Death and sorrow", "Chaos and madness"],
                                correct: 1,
                                explanation: "Unlike Western dragons, Chinese dragons are symbols of good fortune, power, and prosperity."
                            },
                            {
                                question: "What is a Kraken?",
                                options: ["Sky serpent", "Underground dweller", "Sea monster", "Forest guardian"],
                                correct: 2,
                                explanation: "The Kraken is a legendary sea monster, often depicted as a giant squid or octopus."
                            },
                            {
                                question: "Which bird is associated with wisdom in Greek mythology?",
                                options: ["Eagle", "Raven", "Owl", "Swan"],
                                correct: 2,
                                explanation: "The owl is sacred to Athena, the Greek goddess of wisdom, and symbolizes knowledge and wisdom."
                            }
                        ]
                    },
                    future: {
                        title: "Future Technology",
                        icon: "fas fa-robot",
                        questions: [
                            {
                                question: "What does AI stand for in technology?",
                                options: ["Automated Intelligence", "Artificial Intelligence", "Advanced Integration", "Algorithmic Interface"],
                                correct: 1,
                                explanation: "AI stands for Artificial Intelligence, the simulation of human intelligence in machines."
                            },
                            {
                                question: "What is quantum computing primarily designed to solve?",
                                options: ["Simple calculations", "Complex problems", "Basic programming", "File storage"],
                                correct: 1,
                                explanation: "Quantum computing uses quantum mechanics to solve complex problems much faster than classical computers."
                            },
                            {
                                question: "What is the Internet of Things (IoT)?",
                                options: ["A new social media platform", "Connected everyday devices", "A computer virus", "A programming language"],
                                correct: 1,
                                explanation: "IoT refers to the network of physical devices connected to the internet, collecting and sharing data."
                            },
                            {
                                question: "What technology enables virtual reality experiences?",
                                options: ["Radio waves", "Head-mounted displays", "Solar panels", "Magnetic fields"],
                                correct: 1,
                                explanation: "VR primarily uses head-mounted displays along with sensors to create immersive virtual experiences."
                            },
                            {
                                question: "What is blockchain technology best known for?",
                                options: ["Video streaming", "Secure transactions", "Photo editing", "Music production"],
                                correct: 1,
                                explanation: "Blockchain is a distributed ledger technology known for enabling secure, transparent transactions."
                            },
                            {
                                question: "What does 5G technology primarily improve?",
                                options: ["Battery life", "Internet speed", "Screen resolution", "Camera quality"],
                                correct: 1,
                                explanation: "5G technology significantly improves internet speed and reduces latency for mobile communications."
                            },
                            {
                                question: "What is machine learning?",
                                options: ["Teaching robots to walk", "Computers learning from data", "Building physical machines", "Programming video games"],
                                correct: 1,
                                explanation: "Machine learning is a subset of AI where computers learn and improve from experience without being explicitly programmed."
                            },
                            {
                                question: "What is augmented reality (AR)?",
                                options: ["Completely virtual worlds", "Digital info overlaid on real world", "Advanced robotics", "Quantum physics"],
                                correct: 1,
                                explanation: "AR overlays digital information and virtual objects onto the real world through devices like smartphones or AR glasses."
                            },
                            {
                                question: "What is the primary goal of autonomous vehicles?",
                                options: ["Faster speeds", "Self-driving capability", "Better fuel efficiency", "Louder engines"],
                                correct: 1,
                                explanation: "Autonomous vehicles are designed to navigate and operate without human intervention using sensors and AI."
                            },
                            {
                                question: "What is nanotechnology?",
                                options: ["Very large technology", "Manipulation of matter at atomic scale", "Time travel research", "Space exploration tools"],
                                correct: 1,
                                explanation: "Nanotechnology involves manipulating matter at the atomic and molecular scale, typically 1-100 nanometers."
                            }
                        ]
                    }
                };
                
                this.init();
            }

            /**
             * Initializes the QuizApp by binding event listeners and showing the topic selection screen.
             */
            init() {
                this.bindEvents();
                this.showTopicSelection();
            }

            /**
             * Binds event listeners to various UI elements.
             */
            bindEvents() {
                // Event listeners for topic selection cards
                document.querySelectorAll('.topic-card').forEach(card => {
                    card.addEventListener('click', (e) => {
                        const topic = e.currentTarget.dataset.topic;
                        this.startQuiz(topic);
                    });
                });

                // Event listeners for quiz navigation buttons
                document.getElementById('nextBtn').addEventListener('click', () => this.nextQuestion());
                document.getElementById('prevBtn').addEventListener('click', () => this.prevQuestion());

                // Event listeners for result screen buttons
                document.getElementById('restartBtn').addEventListener('click', () => this.restartQuiz());
                document.getElementById('newTopicBtn').addEventListener('click', () => this.showTopicSelection());
                document.getElementById('reviewBtn').addEventListener('click', () => this.showReview());
                document.getElementById('backToResultsBtn').addEventListener('click', () => this.showResults());
            }

            /**
             * Displays the topic selection screen and hides other screens.
             */
            showTopicSelection() {
                document.getElementById('topicSelection').classList.remove('hidden');
                document.getElementById('quizInterface').classList.add('hidden');
                document.getElementById('resultsScreen').classList.add('hidden');
                document.getElementById('reviewScreen').classList.add('hidden');
                // Ensure the question card is not flipped when returning to topic selection
                document.getElementById('questionCard').classList.remove('flipped');
            }

            /**
             * Starts the quiz for the selected topic.
             * @param {string} topic - The key for the selected quiz topic in quizData.
             */
            startQuiz(topic) {
                this.currentTopic = topic;
                this.currentQuestionIndex = 0;
                // Initialize user answers with null for each question
                this.userAnswers = Array(this.quizData[topic].questions.length).fill(null); 
                this.score = 0;
                this.totalTime = 0;
                this.startTime = Date.now(); // Record start time for overall quiz duration
                
                document.getElementById('topicSelection').classList.add('hidden');
                document.getElementById('quizInterface').classList.remove('hidden');
                
                this.loadQuestion();
            }

            /**
             * Loads and displays the current question and its answer options.
             */
            loadQuestion() {
                const quizTopic = this.quizData[this.currentTopic];
                const question = quizTopic.questions[this.currentQuestionIndex];
                const totalQuestions = quizTopic.questions.length;

                // Stop any existing timer
                this.stopTimer();

                // Reset timer for the new question
                this.timeLeft = 30;
                this.updateTimerDisplay(); // Update display immediately
                this.startTimer(); // Start timer for the new question

                // Update question counter and progress bar
                document.getElementById('questionCounter').textContent = `Question ${this.currentQuestionIndex + 1} of ${totalQuestions}`;
                document.getElementById('progressText').textContent = `${this.currentQuestionIndex + 1} / ${totalQuestions}`;
                this.updateProgressBar();

                // Update question icon
                const questionIconElement = document.getElementById('questionIcon');
                questionIconElement.innerHTML = `<i class="${quizTopic.icon} text-white text-xl"></i>`;
                // Add and remove bounce-in for icon animation
                questionIconElement.classList.remove('bounce-in');
                void questionIconElement.offsetWidth; // Trigger reflow
                questionIconElement.classList.add('bounce-in');


                // Update question text
                const questionTextElement = document.getElementById('questionText');
                questionTextElement.textContent = question.question;
                questionTextElement.classList.remove('fade-in');
                void questionTextElement.offsetWidth; // Trigger reflow
                questionTextElement.classList.add('fade-in');


                // Populate answer options
                const answerOptionsDiv = document.getElementById('answerOptions');
                answerOptionsDiv.innerHTML = ''; // Clear previous options

                question.options.forEach((option, index) => {
                    const button = document.createElement('button');
                    button.textContent = option;
                    button.dataset.index = index;
                    button.classList.add(
                        'answer-option',
                        'w-full', 'py-3', 'px-4', 'rounded-xl', 'text-white', 'font-medium',
                        'text-left', 'transition-all', 'duration-200', 'ease-in-out',
                        'focus:outline-none', 'focus:ring-2', 'focus:ring-offset-2',
                        'bg-gray-800', 'hover:bg-blue-700', 'hover:border-blue-400', 'border', 'border-transparent',
                        'shadow-md', 'slide-up' // Apply slide-up animation
                    );
                    button.style.animationDelay = `${index * 0.05}s`; // Stagger animation for options

                    // If user has already answered this question, show their selection and correct answer
                    if (this.userAnswers[this.currentQuestionIndex] !== null) {
                        button.disabled = true; // Disable interaction
                        if (index === question.correct) {
                            button.classList.add('bg-green-600', 'border-green-400', 'hover:bg-green-600', 'focus:ring-green-400');
                        } else if (index === this.userAnswers[this.currentQuestionIndex]) {
                            button.classList.add('bg-red-600', 'border-red-400', 'hover:bg-red-600', 'focus:ring-red-400');
                        }
                    } else {
                        // Attach event listener only if not already answered
                        button.addEventListener('click', () => this.selectAnswer(index));
                    }
                    answerOptionsDiv.appendChild(button);
                });

                // Update navigation button states
                this.updateNavigationButtons();

                // Apply fade-in animation to the card's content
                const questionCardFrontContent = document.querySelector('#questionCard .flip-card-front');
                questionCardFrontContent.classList.remove('fade-in');
                void questionCardFrontContent.offsetWidth; // Trigger reflow
                questionCardFrontContent.classList.add('fade-in');
            }

            /**
             * Handles user answer selection.
             * @param {number} selectedIndex - The index of the option selected by the user.
             */
            selectAnswer(selectedIndex) {
                const question = this.quizData[this.currentTopic].questions[this.currentQuestionIndex];
                
                // Only record answer if not already answered or if it's a timeout
                if (this.userAnswers[this.currentQuestionIndex] === null) {
                    this.userAnswers[this.currentQuestionIndex] = selectedIndex; // Store user's answer
                    this.stopTimer(); // Stop the timer once an answer is selected

                    const options = document.getElementById('answerOptions').children;
                    
                    // Disable all options and provide feedback
                    for (let i = 0; i < options.length; i++) {
                        const optionButton = options[i];
                        optionButton.disabled = true; // Disable further clicks

                        // Remove generic hover styles
                        optionButton.classList.remove('hover:bg-blue-700', 'hover:border-blue-400');

                        if (i === question.correct) {
                            optionButton.classList.add('bg-green-600', 'border-green-400', 'pulse-correct');
                        } else if (i === selectedIndex) {
                            optionButton.classList.add('bg-red-600', 'border-red-400', 'pulse-incorrect');
                        } else {
                            // Dim incorrect, unselected answers
                            optionButton.classList.add('opacity-50');
                        }
                    }

                    // Check if the answer is correct and update score
                    if (selectedIndex === question.correct) {
                        this.score++;
                    }

                    // Calculate time taken for this question and add to total
                    const timeTakenForQuestion = 30 - this.timeLeft; // If user answers quickly
                    this.totalTime += Math.max(0, timeTakenForQuestion); // Ensure time added is non-negative
                }
                
                // Update navigation button states immediately after answer selection
                this.updateNavigationButtons(); 
            }

            /**
             * Updates the width of the progress bar and the progress text.
             */
            updateProgressBar() {
                const totalQuestions = this.quizData[this.currentTopic].questions.length;
                const progressPercentage = ((this.currentQuestionIndex + 1) / totalQuestions) * 100;
                document.getElementById('progressBar').style.width = `${progressPercentage}%`;
            }

            /**
             * Navigates to the next question or shows results if at the end.
             */
            nextQuestion() {
                // If the current question hasn't been answered (e.g., timer ran out and auto-advanced),
                // we still proceed. The 'Next' button is disabled until an answer is selected for current question.
                // So, this function is only called when an answer is already selected or time runs out.
                
                this.currentQuestionIndex++;
                const totalQuestions = this.quizData[this.currentTopic].questions.length;

                if (this.currentQuestionIndex < totalQuestions) {
                    this.loadQuestion();
                } else {
                    this.showResults();
                }
            }

            /**
             * Navigates to the previous question.
             */
            prevQuestion() {
                if (this.currentQuestionIndex > 0) {
                    this.currentQuestionIndex--;
                    this.loadQuestion();
                }
            }

            /**
             * Updates the state of the navigation buttons (Previous/Next).
             * The 'Next' button is enabled only after an answer is selected for the current question.
             */
            updateNavigationButtons() {
                const totalQuestions = this.quizData[this.currentTopic].questions.length;
                document.getElementById('prevBtn').disabled = this.currentQuestionIndex === 0;
                // Enable next button only if an answer has been recorded for the current question
                document.getElementById('nextBtn').disabled = this.userAnswers[this.currentQuestionIndex] === null;
            }

            /**
             * Starts the countdown timer for the current question.
             */
            startTimer() {
                this.stopTimer(); // Clear any existing timer
                this.timeLeft = 30; // Reset time for current question
                this.updateTimerDisplay(); // Update display immediately
                document.getElementById('timer').classList.remove('timer-pulse'); // Remove pulse if active

                this.timer = setInterval(() => {
                    this.timeLeft--;
                    this.updateTimerDisplay();

                    if (this.timeLeft <= 10 && this.timeLeft > 0) {
                        document.getElementById('timer').classList.add('timer-pulse'); // Add pulse animation when low on time
                    } else if (this.timeLeft <= 0) {
                        this.stopTimer();
                        this.selectAnswer(-1); // Mark as unanswered/timed out (-1 indicates no answer)
                        // Auto-advance after a brief delay so user can see the answer feedback
                        setTimeout(() => this.nextQuestion(), 1000); 
                    }
                }, 1000);
            }

            /**
             * Stops the current countdown timer.
             */
            stopTimer() {
                if (this.timer) {
                    clearInterval(this.timer);
                    this.timer = null;
                    document.getElementById('timer').classList.remove('timer-pulse');
                }
            }

            /**
             * Updates the timer display in the UI.
             */
            updateTimerDisplay() {
                document.getElementById('timeLeft').textContent = this.timeLeft;
            }

            /**
             * Displays the final results screen after the quiz is complete.
             */
            showResults() {
                this.stopTimer(); // Ensure timer is stopped
                document.getElementById('quizInterface').classList.add('hidden');
                document.getElementById('reviewScreen').classList.add('hidden');
                document.getElementById('resultsScreen').classList.remove('hidden');

                const totalQuestions = this.quizData[this.currentTopic].questions.length;
                const percentage = totalQuestions > 0 ? ((this.score / totalQuestions) * 100).toFixed(0) : 0;
                const endTime = Date.now();
                const quizDuration = Math.round((endTime - this.startTime) / 1000); // Total time in seconds

                document.getElementById('finalScore').textContent = `${this.score} / ${totalQuestions}`;
                document.getElementById('finalPercentage').textContent = `${percentage}%`;
                document.getElementById('finalTime').textContent = `${quizDuration}s`;
            }

            /**
             * Calls the Gemini API to get a deeper explanation for a question.
             * @param {string} questionText - The question text.
             * @param {string} currentExplanation - The existing explanation.
             * @param {HTMLElement} targetElement - The element to update with the new explanation.
             * @param {HTMLElement} buttonElement - The button that triggered the call.
             */
            async getDeeperExplanation(questionText, currentExplanation, targetElement, buttonElement) {
                // Disable the button and show a loading spinner
                buttonElement.disabled = true;
                buttonElement.innerHTML = '<div class="loader"></div> Generating...';

                const prompt = `Given the quiz question: "${questionText}" and its brief explanation: "${currentExplanation}", provide a more detailed and engaging explanation suitable for a curious learner. Focus on expanding on the key concepts and providing additional context or interesting facts. Keep the response concise but informative, aiming for around 2-3 paragraphs.`;

                try {
                    let chatHistory = [];
                    chatHistory.push({ role: "user", parts: [{ text: prompt }] });
                    const payload = { contents: chatHistory };
                    const apiKey = ""; // Leave as empty string, Canvas will provide at runtime.
                    const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;

                    const response = await fetch(apiUrl, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });

                    const result = await response.json();
                    if (result.candidates && result.candidates.length > 0 &&
                        result.candidates[0].content && result.candidates[0].content.parts &&
                        result.candidates[0].content.parts.length > 0) {
                        const newExplanation = result.candidates[0].content.parts[0].text;
                        targetElement.innerHTML = `<strong class="text-cyan-400">Deeper Explanation:</strong> ${newExplanation}`;
                        buttonElement.remove(); // Remove button after explanation is generated
                    } else {
                        targetElement.innerHTML = `<strong class="text-red-400">Error:</strong> Could not generate deeper explanation.`;
                        buttonElement.innerHTML = '<i class="fas fa-magic mr-2"></i>Get Deeper Explanation ✨';
                        buttonElement.disabled = false;
                    }
                } catch (error) {
                    console.error("Error calling Gemini API:", error);
                    targetElement.innerHTML = `<strong class="text-red-400">Error:</strong> Failed to connect to explanation service.`;
                    buttonElement.innerHTML = '<i class="fas fa-magic mr-2"></i>Get Deeper Explanation ✨';
                    buttonElement.disabled = false;
                }
            }

            /**
             * Displays the review screen, showing all questions with user's answers and correct answers.
             */
            showReview() {
                document.getElementById('resultsScreen').classList.add('hidden');
                document.getElementById('quizInterface').classList.add('hidden');
                document.getElementById('reviewScreen').classList.remove('hidden');

                const reviewContentDiv = document.getElementById('reviewContent');
                reviewContentDiv.innerHTML = ''; // Clear previous content

                this.quizData[this.currentTopic].questions.forEach((q, index) => {
                    const userAnswerIndex = this.userAnswers[index];
                    const userAnswerText = userAnswerIndex !== null && userAnswerIndex !== -1
                        ? q.options[userAnswerIndex]
                        : "No answer / Timed out";
                    const correctAnswerText = q.options[q.correct];
                    const isCorrect = (userAnswerIndex === q.correct);

                    const reviewCard = document.createElement('div');
                    reviewCard.classList.add(
                        'glass', 'border', 'rounded-xl', 'p-6', 'fade-in', 'slide-up',
                        isCorrect ? 'border-green-400/50' : 'border-red-400/50'
                    );

                    reviewCard.innerHTML = `
                        <p class="text-gray-300 text-sm mb-2">Question ${index + 1}</p>
                        <h3 class="font-bold text-white mb-4">${q.question}</h3>
                        <p class="text-gray-200 mb-2">Your Answer: <span class="font-medium ${isCorrect ? 'text-green-300' : 'text-red-300'}">${userAnswerText} ${isCorrect ? '<i class="fas fa-check-circle ml-1"></i>' : '<i class="fas fa-times-circle ml-1"></i>'}</span></p>
                        <p class="text-gray-200 mb-4">Correct Answer: <span class="font-medium text-green-300">${correctAnswerText}</span></p>
                        <div class="p-3 bg-gray-800 rounded-lg text-gray-300 text-sm mb-4" id="explanation-${index}">
                            <strong class="text-cyan-400">Explanation:</strong> ${q.explanation}
                        </div>
                        <button id="deeperExplanationBtn-${index}" class="px-4 py-2 bg-gradient-to-r from-blue-500 to-cyan-500 hover:shadow-xl text-white rounded-xl transition-all shadow-md text-sm">
                            <i class="fas fa-magic mr-2"></i>Get Deeper Explanation ✨
                        </button>
                    `;
                    reviewContentDiv.appendChild(reviewCard);

                    // Add event listener for the "Get Deeper Explanation" button
                    const deeperExplanationBtn = document.getElementById(`deeperExplanationBtn-${index}`);
                    const explanationDiv = document.getElementById(`explanation-${index}`);
                    deeperExplanationBtn.addEventListener('click', () => 
                        this.getDeeperExplanation(q.question, q.explanation, explanationDiv, deeperExplanationBtn)
                    );
                });
            }

            /**
             * Resets the quiz to the first question of the current topic.
             */
            restartQuiz() {
                this.stopTimer();
                this.startQuiz(this.currentTopic); // Re-start quiz for the same topic
            }
        }

        // Initialize the quiz app when the DOM is fully loaded
        document.addEventListener('DOMContentLoaded', () => {
            new QuizApp();
        });
    </script>
</body>
</html>
